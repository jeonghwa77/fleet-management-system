@page "/vehicles"
@using FleetManagementSystem4.Shared.Models

<div class="min-h-screen bg-background">
    <!-- ìƒë‹¨ í—¤ë” -->
    <div class="bg-white border-b border-border">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-4">
                    <div class="w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center">
                        <span class="text-xl text-primary">ğŸš—</span>
                    </div>
                    <div>
                        <h1 class="text-2xl font-bold text-foreground">ì°¨ëŸ‰ ê´€ë¦¬</h1>
                        <p class="text-sm text-muted-foreground">
                            íšŒì‚¬ ì°¨ëŸ‰ì„ ê´€ë¦¬í•˜ê³  ê° ì°¨ëŸ‰ì˜ ì •ë³´ì™€ ìƒ‰ìƒì„ ì„¤ì •í•˜ì„¸ìš”.
                        </p>
                    </div>
                </div>
                @if (onAdd.HasDelegate)
                {
                    <button @onclick="ShowAddModal"
                            class="bg-primary hover:bg-primary/90 text-primary-foreground px-4 py-2 rounded-lg transition-colors font-medium flex items-center space-x-2">
                        <span>â•</span>
                        <span>ì°¨ëŸ‰ ì¶”ê°€</span>
                    </button>
                }
            </div>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        <!-- ì°¨ëŸ‰ ëª©ë¡ -->
        <div class="@(isMobile ? "space-y-3" : "grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4")">
            @foreach (var vehicle in vehicles)
            {
                <div class="bg-card rounded-lg shadow-sm border border-border relative overflow-visible">
                    <div class="p-4 pb-3 overflow-visible">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-2">
                                <div class="w-4 h-4 rounded @GetVehicleColor(vehicle.Id, vehicle.Color)"
                                     title="ìº˜ë¦°ë” ìƒ‰ìƒ: @GetColorLabel(vehicle.Color ?? GetVehicleColor(vehicle.Id, null))"></div>
                                <h3 class="text-lg font-semibold text-foreground">@vehicle.Name</h3>
                            </div>
                            @if (onUpdate.HasDelegate || onDelete.HasDelegate)
                            {
                                <div class="flex space-x-1">
                                    @if (onUpdate.HasDelegate)
                                    {
                                        <button @onclick="() => OpenEditDialog(vehicle)"
                                                class="h-8 w-8 p-0 text-muted-foreground hover:text-foreground hover:bg-muted rounded transition-colors"
                                                title="ì°¨ëŸ‰ ì •ë³´ ìˆ˜ì •">
                                            <span class="text-sm">âœï¸</span>
                                        </button>
                                    }
                                    @if (onDelete.HasDelegate)
                                    {
                                        <button @onclick="() => OpenDeleteDialog(vehicle)"
                                                class="h-8 w-8 p-0 text-red-600 hover:text-red-700 hover:bg-red-50 rounded transition-colors"
                                                title="ì°¨ëŸ‰ ì‚­ì œ">
                                            <span class="text-sm">ğŸ—‘ï¸</span>
                                        </button>
                                    }
                                </div>
                            }
                        </div>
                    </div>
                    
                    <div class="px-4 pb-4">
                        <div class="space-y-3">
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-muted-foreground">ìƒíƒœ</span>
                                @GetStatusBadge(vehicle.Status)
                            </div>
                            
                            <div class="space-y-2 text-sm">
                                <div class="flex items-center justify-between">
                                    <span class="text-muted-foreground">ë²ˆí˜¸íŒ:</span>
                                    <span class="font-mono">@vehicle.LicensePlate</span>
                                </div>
                                
                                <div class="flex items-center justify-between">
                                    <span class="text-muted-foreground">ì°¨ì¢…:</span>
                                    <span>@vehicle.Type</span>
                                </div>
                                
                                <div class="flex items-center justify-between">
                                    <span class="text-muted-foreground">ì—°ë£Œ:</span>
                                    <div class="flex items-center space-x-1">
                                        <span>@GetFuelIcon(vehicle.Fuel)</span>
                                        <span>@vehicle.Fuel</span>
                                    </div>
                                </div>
                                
                                <div class="flex items-center justify-between">
                                    <span class="text-muted-foreground">ìŠ¹ì°¨ì¸ì›:</span>
                                    <div class="flex items-center space-x-1">
                                        <span>ğŸ‘¥</span>
                                        <span>@vehicle.Capacityëª…</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    </div>
</div>

<!-- ì°¨ëŸ‰ ì¶”ê°€ ëª¨ë‹¬ -->
@if (showAddDialog)
{
    <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between p-6 border-b border-border">
                <h2 class="text-xl font-semibold text-foreground">ìƒˆ ì°¨ëŸ‰ ì¶”ê°€</h2>
                <button @onclick="() => showAddDialog = false"
                        class="text-muted-foreground hover:text-foreground p-2 rounded-md transition-colors">
                    âœ•
                </button>
            </div>
            
            <form @onsubmit="HandleAddVehicle" @onsubmit:preventDefault="true" class="p-6 space-y-4">
                @if (!string.IsNullOrEmpty(error))
                {
                    <div class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded">
                        <div class="flex items-center space-x-2">
                            <span>âš ï¸</span>
                            <span>@error</span>
                        </div>
                    </div>
                }
                
                <div>
                    <label class="text-sm font-medium text-foreground mb-2 block">ì°¨ëŸ‰ëª… *</label>
                    <input @bind="newVehicle.Name" 
                           class="w-full px-3 py-2 border border-input rounded-lg bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary/20"
                           placeholder="ì˜ˆ: í˜„ëŒ€ ê·¸ëœì €" />
                </div>
                
                <div>
                    <label class="text-sm font-medium text-foreground mb-2 block">ì°¨ì¢… *</label>
                    <select @bind="newVehicle.Type"
                            class="w-full px-3 py-2 border border-input rounded-lg bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary/20">
                        <option value="">ì°¨ì¢… ì„ íƒ</option>
                        @foreach (var type in VehicleTypes)
                        {
                            <option value="@type">@type</option>
                        }
                    </select>
                </div>
                
                <div>
                    <label class="text-sm font-medium text-foreground mb-2 block">ë²ˆí˜¸íŒ *</label>
                    <input @bind="newVehicle.LicensePlate" 
                           class="w-full px-3 py-2 border border-input rounded-lg bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary/20"
                           placeholder="ì˜ˆ: ì„œìš¸12ê°€3456" />
                </div>
                
                <div>
                    <label class="text-sm font-medium text-foreground mb-2 block">ì—°ë£Œ íƒ€ì… *</label>
                    <select @bind="newVehicle.Fuel"
                            class="w-full px-3 py-2 border border-input rounded-lg bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary/20">
                        <option value="">ì—°ë£Œ ì„ íƒ</option>
                        @foreach (var fuel in FuelTypes)
                        {
                            <option value="@fuel">@fuel</option>
                        }
                    </select>
                </div>
                
                <div>
                    <label class="text-sm font-medium text-foreground mb-2 block">ìŠ¹ì°¨ì¸ì›</label>
                    <input @bind="newVehicle.Capacity" type="number" min="1" max="50"
                           class="w-full px-3 py-2 border border-input rounded-lg bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary/20" />
                </div>
                
                <div>
                    <label class="text-sm font-medium text-foreground mb-2 block">ìƒíƒœ</label>
                    <select @bind="newVehicle.Status"
                            class="w-full px-3 py-2 border border-input rounded-lg bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary/20">
                        <option value="Available">ìš´í–‰ ê°€ëŠ¥</option>
                        <option value="InUse">ìš´í–‰ ì¤‘</option>
                        <option value="Maintenance">ì •ë¹„ ì¤‘</option>
                        <option value="OutOfService">ìš´í–‰ ë¶ˆê°€</option>
                    </select>
                </div>
                
                <div>
                    <label class="text-sm font-medium text-foreground mb-2 block">ìº˜ë¦°ë” ìƒ‰ìƒ</label>
                    <div class="grid grid-cols-6 gap-2">
                        @foreach (var color in DefaultColors)
                        {
                            <button type="button" @onclick="() => newVehicle.Color = color.Value"
                                    class="w-8 h-8 rounded border-2 @(newVehicle.Color == color.Value ? "border-gray-900" : "border-gray-300") @color.Value"
                                    title="@color.Label">
                            </button>
                        }
                    </div>
                </div>
                
                <div class="flex justify-end space-x-2 pt-4 border-t border-border">
                    <button type="button" @onclick="() => showAddDialog = false"
                            class="bg-secondary hover:bg-secondary/80 text-secondary-foreground px-4 py-2 rounded-lg transition-colors font-medium">
                        ì·¨ì†Œ
                    </button>
                    <button type="submit" disabled="@isSubmitting"
                            class="bg-primary hover:bg-primary/90 text-primary-foreground px-4 py-2 rounded-lg transition-colors font-medium disabled:opacity-50">
                        @if (isSubmitting)
                        {
                            <span>ì¶”ê°€ ì¤‘...</span>
                        }
                        else
                        {
                            <span>ì¶”ê°€</span>
                        }
                    </button>
                </div>
            </form>
        </div>
    </div>
}

<!-- ì°¨ëŸ‰ ìˆ˜ì • ëª¨ë‹¬ -->
@if (showEditDialog && selectedVehicle != null)
{
    <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex items-center justify-between p-6 border-b border-border">
                <h2 class="text-xl font-semibold text-foreground">ì°¨ëŸ‰ ì •ë³´ ìˆ˜ì •</h2>
                <button @onclick="() => showEditDialog = false"
                        class="text-muted-foreground hover:text-foreground p-2 rounded-md transition-colors">
                    âœ•
                </button>
            </div>
            
            <form @onsubmit="HandleUpdateVehicle" @onsubmit:preventDefault="true" class="p-6 space-y-4">
                @if (!string.IsNullOrEmpty(error))
                {
                    <div class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded">
                        <div class="flex items-center space-x-2">
                            <span>âš ï¸</span>
                            <span>@error</span>
                        </div>
                    </div>
                }
                
                <div>
                    <label class="text-sm font-medium text-foreground mb-2 block">ì°¨ëŸ‰ëª… *</label>
                    <input @bind="editVehicle.Name" 
                           class="w-full px-3 py-2 border border-input rounded-lg bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary/20"
                           placeholder="ì˜ˆ: í˜„ëŒ€ ê·¸ëœì €" />
                </div>
                
                <div>
                    <label class="text-sm font-medium text-foreground mb-2 block">ì°¨ì¢… *</label>
                    <select @bind="editVehicle.Type"
                            class="w-full px-3 py-2 border border-input rounded-lg bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary/20">
                        <option value="">ì°¨ì¢… ì„ íƒ</option>
                        @foreach (var type in VehicleTypes)
                        {
                            <option value="@type">@type</option>
                        }
                    </select>
                </div>
                
                <div>
                    <label class="text-sm font-medium text-foreground mb-2 block">ë²ˆí˜¸íŒ *</label>
                    <input @bind="editVehicle.LicensePlate" 
                           class="w-full px-3 py-2 border border-input rounded-lg bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary/20"
                           placeholder="ì˜ˆ: ì„œìš¸12ê°€3456" />
                </div>
                
                <div>
                    <label class="text-sm font-medium text-foreground mb-2 block">ì—°ë£Œ íƒ€ì… *</label>
                    <select @bind="editVehicle.Fuel"
                            class="w-full px-3 py-2 border border-input rounded-lg bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary/20">
                        <option value="">ì—°ë£Œ ì„ íƒ</option>
                        @foreach (var fuel in FuelTypes)
                        {
                            <option value="@fuel">@fuel</option>
                        }
                    </select>
                </div>
                
                <div>
                    <label class="text-sm font-medium text-foreground mb-2 block">ìŠ¹ì°¨ì¸ì›</label>
                    <input @bind="editVehicle.Capacity" type="number" min="1" max="50"
                           class="w-full px-3 py-2 border border-input rounded-lg bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary/20" />
                </div>
                
                <div>
                    <label class="text-sm font-medium text-foreground mb-2 block">ìƒíƒœ</label>
                    <select @bind="editVehicle.Status"
                            class="w-full px-3 py-2 border border-input rounded-lg bg-background text-foreground focus:outline-none focus:ring-2 focus:ring-primary/20">
                        <option value="Available">ìš´í–‰ ê°€ëŠ¥</option>
                        <option value="InUse">ìš´í–‰ ì¤‘</option>
                        <option value="Maintenance">ì •ë¹„ ì¤‘</option>
                        <option value="OutOfService">ìš´í–‰ ë¶ˆê°€</option>
                    </select>
                </div>
                
                <div>
                    <label class="text-sm font-medium text-foreground mb-2 block">ìº˜ë¦°ë” ìƒ‰ìƒ</label>
                    <div class="grid grid-cols-6 gap-2">
                        @foreach (var color in DefaultColors)
                        {
                            <button type="button" @onclick="() => editVehicle.Color = color.Value"
                                    class="w-8 h-8 rounded border-2 @(editVehicle.Color == color.Value ? "border-gray-900" : "border-gray-300") @color.Value"
                                    title="@color.Label">
                            </button>
                        }
                    </div>
                </div>
                
                <div class="flex justify-end space-x-2 pt-4 border-t border-border">
                    <button type="button" @onclick="() => showEditDialog = false"
                            class="bg-secondary hover:bg-secondary/80 text-secondary-foreground px-4 py-2 rounded-lg transition-colors font-medium">
                        ì·¨ì†Œ
                    </button>
                    <button type="submit" disabled="@isSubmitting"
                            class="bg-primary hover:bg-primary/90 text-primary-foreground px-4 py-2 rounded-lg transition-colors font-medium disabled:opacity-50">
                        @if (isSubmitting)
                        {
                            <span>ìˆ˜ì • ì¤‘...</span>
                        }
                        else
                        {
                            <span>ìˆ˜ì •</span>
                        }
                    </button>
                </div>
            </form>
        </div>
    </div>
}

<!-- ì°¨ëŸ‰ ì‚­ì œ í™•ì¸ ëª¨ë‹¬ -->
@if (showDeleteDialog && selectedVehicle != null)
{
    <div class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4">
            <div class="p-6">
                <div class="flex items-center space-x-3 mb-4">
                    <div class="w-12 h-12 bg-red-100 rounded-lg flex items-center justify-center">
                        <span class="text-2xl text-red-600">âš ï¸</span>
                    </div>
                    <div>
                        <h2 class="text-xl font-semibold text-foreground">ì°¨ëŸ‰ ì‚­ì œ</h2>
                        <p class="text-sm text-muted-foreground">ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                </div>
                
                <p class="text-foreground mb-6">
                    ì •ë§ë¡œ '<strong>@selectedVehicle.Name</strong>' ì°¨ëŸ‰ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?
                </p>
                
                <div class="flex justify-end space-x-2">
                    <button @onclick="() => showDeleteDialog = false"
                            class="bg-secondary hover:bg-secondary/80 text-secondary-foreground px-4 py-2 rounded-lg transition-colors font-medium">
                        ì·¨ì†Œ
                    </button>
                    <button @onclick="HandleDeleteVehicle" disabled="@isSubmitting"
                            class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors font-medium disabled:opacity-50">
                        @if (isSubmitting)
                        {
                            <span>ì‚­ì œ ì¤‘...</span>
                        }
                        else
                        {
                            <span>ì‚­ì œ</span>
                        }
                    </button>
                </div>
            </div>
        </div>
    </div>
}

@code {
    [Parameter] public List<Vehicle> vehicles { get; set; } = new();
    [Parameter] public bool isMobile { get; set; } = false;
    [Parameter] public EventCallback onRefresh { get; set; }
    [Parameter] public EventCallback<Vehicle> onAdd { get; set; }
    [Parameter] public EventCallback<(string id, Vehicle updates)> onUpdate { get; set; }
    [Parameter] public EventCallback<string> onDelete { get; set; }

    private bool showAddDialog = false;
    private bool showEditDialog = false;
    private bool showDeleteDialog = false;
    private Vehicle? selectedVehicle = null;
    private bool isSubmitting = false;
    private string? error = null;

    // ìƒˆ ì°¨ëŸ‰ ì¶”ê°€ í¼
    private Vehicle newVehicle = new()
    {
        Name = "",
        Type = "",
        LicensePlate = "",
        Fuel = "",
        Capacity = 4,
        Status = "Available",
        Color = "bg-blue-500"
    };

    // ì°¨ëŸ‰ ìˆ˜ì • í¼
    private Vehicle editVehicle = new()
    {
        Name = "",
        Type = "",
        LicensePlate = "",
        Fuel = "",
        Capacity = 4,
        Status = "Available",
        Color = "bg-blue-500"
    };

    private readonly List<(string Value, string Label)> DefaultColors = new()
    {
        ("bg-blue-500", "íŒŒë€ìƒ‰"),
        ("bg-green-500", "ì´ˆë¡ìƒ‰"),
        ("bg-yellow-500", "ë…¸ë€ìƒ‰"),
        ("bg-purple-500", "ë³´ë¼ìƒ‰"),
        ("bg-pink-500", "ë¶„í™ìƒ‰"),
        ("bg-indigo-500", "ë‚¨ìƒ‰"),
        ("bg-red-500", "ë¹¨ê°„ìƒ‰"),
        ("bg-orange-500", "ì£¼í™©ìƒ‰"),
        ("bg-teal-500", "ì²­ë¡ìƒ‰"),
        ("bg-cyan-500", "í•˜ëŠ˜ìƒ‰"),
        ("bg-lime-500", "ë¼ì„ìƒ‰"),
        ("bg-emerald-500", "ì—ë©”ë„ë“œìƒ‰")
    };

    private readonly string[] VehicleTypes = { "ìŠ¹ìš©ì°¨", "SUV", "ìŠ¹í•©ì°¨", "íŠ¸ëŸ­", "ë²„ìŠ¤", "ê¸°íƒ€" };
    private readonly string[] FuelTypes = { "íœ˜ë°œìœ ", "ê²½ìœ ", "í•˜ì´ë¸Œë¦¬ë“œ", "ì „ê¸°", "LPG" };

    private string GetVehicleColor(string vehicleId, string? customColor)
    {
        if (!string.IsNullOrEmpty(customColor)) return customColor;
        
        var hash = 0;
        foreach (char c in vehicleId)
        {
            hash = (int)c + ((hash << 5) - hash);
        }
        var index = Math.Abs(hash) % DefaultColors.Count;
        return DefaultColors[index].Value;
    }

    private string GetColorLabel(string colorValue)
    {
        var color = DefaultColors.FirstOrDefault(c => c.Value == colorValue);
        return color.Label ?? "ê¸°ë³¸ìƒ‰";
    }

    private RenderFragment GetStatusBadge(string status)
    {
        var (text, className) = status switch
        {
            "Available" => ("ìš´í–‰ ê°€ëŠ¥", "bg-green-100 text-green-800"),
            "InUse" => ("ìš´í–‰ ì¤‘", "bg-blue-100 text-blue-800"),
            "Maintenance" => ("ì •ë¹„ ì¤‘", "bg-orange-100 text-orange-800"),
            "OutOfService" => ("ìš´í–‰ ë¶ˆê°€", "bg-red-100 text-red-800"),
            _ => ("ì•Œ ìˆ˜ ì—†ìŒ", "bg-gray-100 text-gray-800")
        };

        return @<span class="px-2 py-1 rounded-full text-xs font-medium @className">@text</span>;
    }

    private string GetFuelIcon(string fuelType)
    {
        return fuelType switch
        {
            "íœ˜ë°œìœ " => "â›½",
            "ê²½ìœ " => "ğŸ›¢ï¸",
            "í•˜ì´ë¸Œë¦¬ë“œ" => "ğŸ”‹",
            "ì „ê¸°" => "âš¡",
            "LPG" => "ğŸ’¨",
            _ => "â›½"
        };
    }

    private void ShowAddModal()
    {
        newVehicle = new Vehicle
        {
            Name = "",
            Type = "",
            LicensePlate = "",
            Fuel = "",
            Capacity = 4,
            Status = "Available",
            Color = DefaultColors[0].Value
        };
        showAddDialog = true;
        error = null;
    }

    private void OpenEditDialog(Vehicle vehicle)
    {
        selectedVehicle = vehicle;
        editVehicle = new Vehicle
        {
            Id = vehicle.Id,
            Name = vehicle.Name,
            Type = vehicle.Type,
            LicensePlate = vehicle.LicensePlate,
            Fuel = vehicle.Fuel,
            Capacity = vehicle.Capacity,
            Status = vehicle.Status,
            Color = vehicle.Color ?? GetVehicleColor(vehicle.Id, null),
            Year = vehicle.Year,
            Mileage = vehicle.Mileage,
            LastMaintenance = vehicle.LastMaintenance,
            NextMaintenance = vehicle.NextMaintenance,
            InsuranceExpiry = vehicle.InsuranceExpiry
        };
        showEditDialog = true;
        error = null;
    }

    private void OpenDeleteDialog(Vehicle vehicle)
    {
        selectedVehicle = vehicle;
        showDeleteDialog = true;
        error = null;
    }

    private async Task HandleAddVehicle()
    {
        if (string.IsNullOrEmpty(newVehicle.Name) || string.IsNullOrEmpty(newVehicle.Type) || 
            string.IsNullOrEmpty(newVehicle.LicensePlate) || string.IsNullOrEmpty(newVehicle.Fuel))
        {
            error = "ëª¨ë“  í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.";
            return;
        }

        isSubmitting = true;
        error = null;

        try
        {
            if (onAdd.HasDelegate)
            {
                await onAdd.InvokeAsync(newVehicle);
                showAddDialog = false;
                ShowAddModal(); // í¼ ë¦¬ì…‹
            }
        }
        catch (Exception ex)
        {
            error = $"ì°¨ëŸ‰ ì¶”ê°€ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: {ex.Message}";
        }
        finally
        {
            isSubmitting = false;
        }
    }

    private async Task HandleUpdateVehicle()
    {
        if (string.IsNullOrEmpty(editVehicle.Name) || string.IsNullOrEmpty(editVehicle.Type) || 
            string.IsNullOrEmpty(editVehicle.LicensePlate) || string.IsNullOrEmpty(editVehicle.Fuel))
        {
            error = "ëª¨ë“  í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.";
            return;
        }

        if (selectedVehicle == null) return;

        isSubmitting = true;
        error = null;

        try
        {
            if (onUpdate.HasDelegate)
            {
                await onUpdate.InvokeAsync((selectedVehicle.Id, editVehicle));
                showEditDialog = false;
                selectedVehicle = null;
            }
        }
        catch (Exception ex)
        {
            error = $"ì°¨ëŸ‰ ìˆ˜ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: {ex.Message}";
        }
        finally
        {
            isSubmitting = false;
        }
    }

    private async Task HandleDeleteVehicle()
    {
        if (selectedVehicle == null) return;

        isSubmitting = true;
        error = null;

        try
        {
            if (onDelete.HasDelegate)
            {
                await onDelete.InvokeAsync(selectedVehicle.Id);
                showDeleteDialog = false;
                selectedVehicle = null;
            }
        }
        catch (Exception ex)
        {
            error = $"ì°¨ëŸ‰ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: {ex.Message}";
        }
        finally
        {
            isSubmitting = false;
        }
    }
}
