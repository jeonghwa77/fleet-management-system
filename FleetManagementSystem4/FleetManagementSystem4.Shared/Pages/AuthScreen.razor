@page "/login"
@using Microsoft.AspNetCore.Components.Forms
@using Microsoft.Extensions.Configuration
@using Microsoft.AspNetCore.Components

@code {
    public class AuthScreenSignInArgs
    {
        public string Email { get; set; } = "";
        public string Password { get; set; } = "";
    }

    public class AuthScreenSignUpArgs
    {
        public string Name { get; set; } = "";
        public string Email { get; set; } = "";
        public string Department { get; set; } = "";
        public string Password { get; set; } = "";
    }

    [Parameter]
    public EventCallback<AuthScreenSignInArgs> OnSignIn { get; set; }
    
    [Parameter]
    public EventCallback<AuthScreenSignUpArgs> OnSignUp { get; set; }
}

<div class="min-h-screen bg-background flex items-center justify-center p-4">
    <div class="w-full max-w-md">
        <!-- ë¡œê³  ë° ì œëª© -->
        <div class="text-center mb-8">
            <div class="w-16 h-16 bg-primary rounded-2xl mx-auto mb-4 flex items-center justify-center">
                <span class="text-2xl text-white">ğŸš—</span>
            </div>
            <h1 class="text-2xl font-bold text-foreground mb-2">ë²•ì¸ì°¨ëŸ‰ ì˜ˆì•½ê´€ë¦¬</h1>
            <p class="text-muted-foreground">íšŒì‚¬ ì°¨ëŸ‰ì„ íš¨ìœ¨ì ìœ¼ë¡œ ê´€ë¦¬í•˜ê³  ì˜ˆì•½í•˜ì„¸ìš”</p>
        </div>

        @if (!string.IsNullOrEmpty(ErrorMessage))
        {
            <div class="mb-4 p-3 bg-destructive/10 border border-destructive/20 rounded-lg">
                <div class="flex items-center text-destructive">
                    <span class="mr-2">â—</span>
                    <span class="text-sm">@ErrorMessage</span>
                </div>
            </div>
        }
        @if (!string.IsNullOrEmpty(SuccessMessage))
        {
            <div class="mb-4 p-3 bg-green-50 border border-green-200 rounded-lg">
                <div class="flex items-center text-green-700">
                    <span class="mr-2">âœ…</span>
                    <span class="text-sm">@SuccessMessage</span>
                </div>
            </div>
        }

        <div class="bg-white rounded-2xl shadow-lg border border-border p-6">
            <div class="flex mb-6">
                <button class="flex-1 py-2 px-4 text-sm font-medium rounded-lg transition-colors @(ActiveTab=="signin" ? "bg-primary/10 text-primary" : "bg-muted text-muted-foreground hover:bg-muted/80")" 
                        @onclick="@(()=>ActiveTab = "signin")">
                    ë¡œê·¸ì¸
                </button>
                <button class="flex-1 py-2 px-4 text-sm font-medium rounded-lg transition-colors @(ActiveTab=="signup" ? "bg-primary/10 text-primary" : "bg-muted text-muted-foreground hover:bg-muted/80")" 
                        @onclick="@(()=>ActiveTab = "signup")">
                    íšŒì›ê°€ì…
                </button>
            </div>

            @if (ActiveTab == "signin")
            {
                <EditForm Model="this" FormName="signin-form" OnValidSubmit="OnLoginClick">
                    <div class="space-y-4">
                        <div>
                            <label for="signin-email" class="block text-sm font-medium text-foreground mb-2">ì´ë©”ì¼</label>
                            <InputText @bind-Value="SignInEmail" type="email" id="signin-email"
                                     class="w-full px-3 py-2 border border-input rounded-lg focus:outline-none focus:ring-2 focus:ring-ring bg-background" 
                                     required />
                        </div>
                        <div>
                            <label for="signin-password" class="block text-sm font-medium text-foreground mb-2">ë¹„ë°€ë²ˆí˜¸</label>
                            <InputText @bind-Value="SignInPassword" type="password" id="signin-password"
                                     class="w-full px-3 py-2 border border-input rounded-lg focus:outline-none focus:ring-2 focus:ring-ring bg-background" 
                                     required />
                        </div>
                        <button type="submit" 
                                class="w-full bg-primary hover:bg-primary/90 text-primary-foreground font-medium py-3 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed" 
                                disabled="@IsLoading">
                            @(IsLoading ? "ë¡œê·¸ì¸ ì¤‘..." : "ë¡œê·¸ì¸")
                        </button>
                    </div>
                </EditForm>
                
                <div class="mt-6 p-4 bg-muted/50 rounded-lg">
                    <p class="text-sm font-medium text-foreground mb-2">ë°ëª¨ ê³„ì •:</p>
                    <div class="space-y-1 text-sm text-muted-foreground">
                        <p><span class="font-medium">ì¼ë°˜ ì‚¬ìš©ì:</span> demo@company.com / demo123</p>
                        <p class="text-xs ml-4">ê¹€ë¯¼ìˆ˜ - í”„ë¡œì íŠ¸ 1íŒ€</p>
                        <p><span class="font-medium">ê´€ë¦¬ì:</span> admin@company.com / admin123</p>
                        <p class="text-xs ml-4">ê´€ë¦¬ì - ê²½ì˜ì§€ì›íŒ€</p>
                        <p><span class="font-medium">ê¸°íƒ€:</span> user@company.com / user123</p>
                        <p class="text-xs ml-4">ì´ì˜í¬ - ì—°êµ¬ê°œë°œíŒ€</p>
                    </div>
                </div>
            }
            else if (ActiveTab == "signup")
            {
                <EditForm Model="this" FormName="signup-editform" OnValidSubmit="OnSignUpClick">
                    <div class="space-y-4">
                        <div>
                            <label for="signup-name" class="block text-sm font-medium text-foreground mb-2">ì´ë¦„</label>
                            <InputText @bind-Value="SignUpName" id="signup-name"
                                     class="w-full px-3 py-2 border border-input rounded-lg focus:outline-none focus:ring-2 focus:ring-ring bg-background" 
                                     required />
                        </div>
                        <div>
                            <label for="signup-department" class="block text-sm font-medium text-foreground mb-2">ë¶€ì„œ</label>
                            <select @bind="SignUpDepartment" id="signup-department"
                                    class="w-full px-3 py-2 border border-input rounded-lg focus:outline-none focus:ring-2 focus:ring-ring bg-background" 
                                    required>
                                <option value="">ë¶€ì„œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</option>
                                @foreach (var dept in Departments)
                                {
                                    <option value="@dept">@dept</option>
                                }
                            </select>
                        </div>
                        <div>
                            <label for="signup-email" class="block text-sm font-medium text-foreground mb-2">ì´ë©”ì¼</label>
                            <InputText @bind-Value="SignUpEmail" type="email" id="signup-email"
                                     class="w-full px-3 py-2 border border-input rounded-lg focus:outline-none focus:ring-2 focus:ring-ring bg-background" 
                                     required />
                        </div>
                        <div>
                            <label for="signup-password" class="block text-sm font-medium text-foreground mb-2">ë¹„ë°€ë²ˆí˜¸</label>
                            <InputText @bind-Value="SignUpPassword" type="password" id="signup-password"
                                     class="w-full px-3 py-2 border border-input rounded-lg focus:outline-none focus:ring-2 focus:ring-ring bg-background" 
                                     required minlength="6" />
                            <p class="text-xs text-muted-foreground mt-1">ìµœì†Œ 6ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”</p>
                        </div>
                        <button type="submit" 
                                class="w-full bg-primary hover:bg-primary/90 text-primary-foreground font-medium py-3 rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed" 
                                disabled="@IsLoading">
                            @(IsLoading ? "ê°€ì… ì¤‘..." : "íšŒì›ê°€ì…")
                        </button>
                    </div>
                </EditForm>
            }
        </div>
        
        <p class="text-center text-sm text-muted-foreground mt-6">
            ë²•ì¸ì°¨ëŸ‰ ì˜ˆì•½ê´€ë¦¬ ì‹œìŠ¤í…œ v1.0
        </p>
    </div>
</div>

@code {
    private string ActiveTab { get; set; } = "signin";
    private bool IsLoading { get; set; } = false;
    private string? ErrorMessage { get; set; }
    private string? SuccessMessage { get; set; }

    // ë¡œê·¸ì¸ í¼
    [SupplyParameterFromForm]
    private string SignInEmail { get; set; } = "";
    [SupplyParameterFromForm]
    private string SignInPassword { get; set; } = "";

    // íšŒì›ê°€ì… í¼
    [SupplyParameterFromForm]
    private string SignUpEmail { get; set; } = "";
    [SupplyParameterFromForm]
    private string SignUpPassword { get; set; } = "";
    [SupplyParameterFromForm]
    private string SignUpName { get; set; } = "";
    [SupplyParameterFromForm]
    private string SignUpDepartment { get; set; } = "";
    private List<string> Departments { get; set; } = new() 
    { 
        "í”„ë¡œì íŠ¸ 1íŒ€", 
        "í”„ë¡œì íŠ¸ 2íŒ€", 
        "ì—°êµ¬ê°œë°œíŒ€", 
        "ê²½ì˜ì§€ì›íŒ€", 
        "ê¸°ìˆ ì˜ì—…íŒ€" 
    };

    [Inject]
    private NavigationManager? NavigationManager { get; set; }

    private async Task OnLoginClick()
    {
        IsLoading = true;
        ErrorMessage = null;
        var args = new AuthScreenSignInArgs { Email = SignInEmail, Password = SignInPassword };
        await OnSignIn.InvokeAsync(args);
        IsLoading = false;
    }

    private async Task OnSignUpClick()
    {
        IsLoading = true;
        ErrorMessage = null;
        SuccessMessage = null;

        // ìœ íš¨ì„± ê²€ì‚¬
        if (string.IsNullOrWhiteSpace(SignUpName) || 
            string.IsNullOrWhiteSpace(SignUpEmail) || 
            string.IsNullOrWhiteSpace(SignUpDepartment) || 
            string.IsNullOrWhiteSpace(SignUpPassword))
        {
            ErrorMessage = "ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.";
            IsLoading = false;
            return;
        }

        if (SignUpPassword.Length < 6)
        {
            ErrorMessage = "ë¹„ë°€ë²ˆí˜¸ëŠ” 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.";
            IsLoading = false;
            return;
        }

        try
        {
            var args = new AuthScreenSignUpArgs 
            { 
                Name = SignUpName,
                Email = SignUpEmail, 
                Department = SignUpDepartment,
                Password = SignUpPassword 
            };
            
            await OnSignUp.InvokeAsync(args);
        }
        catch (Exception ex)
        {
            ErrorMessage = $"íšŒì›ê°€ì… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {ex.Message}";
        }
        finally
        {
            IsLoading = false;
        }
    }

    public void ShowSignUpSuccess()
    {
        SuccessMessage = "íšŒì›ê°€ì…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.";
        ActiveTab = "signin";
        ClearSignUpForm();
        StateHasChanged();
    }

    public void ShowSignUpError(string message)
    {
        ErrorMessage = message;
        StateHasChanged();
    }

    private void ClearSignUpForm()
    {
        SignUpEmail = "";
        SignUpPassword = "";
        SignUpName = "";
        SignUpDepartment = "";
    }
}
