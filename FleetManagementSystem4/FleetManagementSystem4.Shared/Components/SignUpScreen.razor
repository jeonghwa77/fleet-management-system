@using FleetManagementSystem4.Shared.Models

<div class="min-h-screen bg-background flex items-center justify-center p-4">
    <div class="max-w-md w-full space-y-8">
        <div class="text-center">
            <div class="flex items-center justify-center w-16 h-16 bg-primary rounded-full mx-auto mb-4">
                <span class="text-primary-foreground text-2xl">ğŸš—</span>
            </div>
            <h2 class="text-3xl font-bold text-foreground">íšŒì›ê°€ì…</h2>
            <p class="mt-2 text-sm text-muted-foreground">
                ë²•ì¸ì°¨ëŸ‰ ì˜ˆì•½ê´€ë¦¬ ì‹œìŠ¤í…œì— ê°€ì…í•˜ì„¸ìš”
            </p>
        </div>

        <div class="bg-card p-8 rounded-lg shadow-lg border border-border">
            @if (!string.IsNullOrEmpty(Message))
            {
                <div class="mb-4 p-3 rounded-md @(IsSuccess ? "bg-green-100 text-green-800" : "bg-red-100 text-red-800")">
                    @Message
                </div>
            }

            <form @formname="signup-form" @onsubmit="HandleSignUp" @onsubmit:preventDefault="true">
                <div class="space-y-4">
                    <div>
                        <label for="name" class="block text-sm font-medium text-foreground mb-1">
                            ì´ë¦„
                        </label>
                        <input
                            id="name"
                            type="text"
                            @bind="Name"
                            @bind:event="oninput"
                            class="w-full px-3 py-2 border border-input rounded-md shadow-sm placeholder-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:border-transparent"
                            placeholder="í™ê¸¸ë™"
                            required />
                    </div>

                    <div>
                        <label for="email" class="block text-sm font-medium text-foreground mb-1">
                            ì´ë©”ì¼
                        </label>
                        <input
                            id="email"
                            type="email"
                            @bind="Email"
                            @bind:event="oninput"
                            class="w-full px-3 py-2 border border-input rounded-md shadow-sm placeholder-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:border-transparent"
                            placeholder="your.email@company.com"
                            required />
                    </div>

                    <div>
                        <label for="department" class="block text-sm font-medium text-foreground mb-1">
                            ë¶€ì„œ
                        </label>
                        <select
                            id="department"
                            @bind="Department"
                            class="w-full px-3 py-2 border border-input rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-ring focus:border-transparent"
                            required>
                            <option value="">ë¶€ì„œë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="í”„ë¡œì íŠ¸ 1íŒ€">í”„ë¡œì íŠ¸ 1íŒ€</option>
                            <option value="í”„ë¡œì íŠ¸ 2íŒ€">í”„ë¡œì íŠ¸ 2íŒ€</option>
                            <option value="ì—°êµ¬ê°œë°œíŒ€">ì—°êµ¬ê°œë°œíŒ€</option>
                            <option value="ê²½ì˜ì§€ì›íŒ€">ê²½ì˜ì§€ì›íŒ€</option>
                            <option value="ê¸°ìˆ ì˜ì—…íŒ€">ê¸°ìˆ ì˜ì—…íŒ€</option>
                        </select>
                    </div>

                    <div>
                        <label for="password" class="block text-sm font-medium text-foreground mb-1">
                            ë¹„ë°€ë²ˆí˜¸
                        </label>
                        <input
                            id="password"
                            type="password"
                            @bind="Password"
                            @bind:event="oninput"
                            class="w-full px-3 py-2 border border-input rounded-md shadow-sm placeholder-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:border-transparent"
                            placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
                            required />
                    </div>

                    <div>
                        <label for="confirmPassword" class="block text-sm font-medium text-foreground mb-1">
                            ë¹„ë°€ë²ˆí˜¸ í™•ì¸
                        </label>
                        <input
                            id="confirmPassword"
                            type="password"
                            @bind="ConfirmPassword"
                            @bind:event="oninput"
                            class="w-full px-3 py-2 border border-input rounded-md shadow-sm placeholder-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:border-transparent"
                            placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ì…ë ¥í•˜ì„¸ìš”"
                            required />
                    </div>
                </div>

                <div class="mt-6">
                    <button
                        type="submit"
                        disabled="@IsLoading"
                        class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-primary-foreground bg-primary hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-ring disabled:opacity-50 disabled:cursor-not-allowed">
                        @if (IsLoading)
                        {
                            <span class="flex items-center">
                                <span class="animate-spin mr-2">â³</span>
                                íšŒì›ê°€ì… ì¤‘...
                            </span>
                        }
                        else
                        {
                            <span>íšŒì›ê°€ì…</span>
                        }
                    </button>
                </div>

                <div class="mt-4 text-center">
                    <button
                        type="button"
                        @onclick="() => OnSwitchToSignIn.InvokeAsync()"
                        class="text-sm text-primary hover:text-primary/80 transition-colors">
                        ì´ë¯¸ ê³„ì •ì´ ìˆìœ¼ì‹ ê°€ìš”? ë¡œê·¸ì¸í•˜ê¸°
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

@code {
    [Parameter] public EventCallback<(string Name, string Email, string Department, string Password)> OnSignUp { get; set; }
    [Parameter] public EventCallback OnSwitchToSignIn { get; set; }

    private string Name = "";
    private string Email = "";
    private string Department = "";
    private string Password = "";
    private string ConfirmPassword = "";
    private bool IsLoading = false;
    private string Message = "";
    private bool IsSuccess = false;

    private async Task HandleSignUp()
    {
        // ìœ íš¨ì„± ê²€ì‚¬
        if (string.IsNullOrWhiteSpace(Name))
        {
            Message = "ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.";
            IsSuccess = false;
            return;
        }

        if (string.IsNullOrWhiteSpace(Email))
        {
            Message = "ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.";
            IsSuccess = false;
            return;
        }

        if (string.IsNullOrWhiteSpace(Department))
        {
            Message = "ë¶€ì„œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.";
            IsSuccess = false;
            return;
        }

        if (string.IsNullOrWhiteSpace(Password))
        {
            Message = "ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.";
            IsSuccess = false;
            return;
        }

        if (Password.Length < 6)
        {
            Message = "ë¹„ë°€ë²ˆí˜¸ëŠ” 6ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.";
            IsSuccess = false;
            return;
        }

        if (Password != ConfirmPassword)
        {
            Message = "ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.";
            IsSuccess = false;
            return;
        }

        IsLoading = true;
        Message = "";

        try
        {
            await OnSignUp.InvokeAsync((Name, Email, Department, Password));
        }
        finally
        {
            IsLoading = false;
        }
    }

    public void ShowMessage(string message, bool success)
    {
        Message = message;
        IsSuccess = success;
        StateHasChanged();
    }

    public void ClearForm()
    {
        Name = "";
        Email = "";
        Department = "";
        Password = "";
        ConfirmPassword = "";
        Message = "";
        IsSuccess = false;
        StateHasChanged();
    }
}
