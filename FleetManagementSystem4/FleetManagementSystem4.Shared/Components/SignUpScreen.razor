@using FleetManagementSystem4.Shared.Models

<div class="min-h-screen bg-background flex items-center justify-center p-4">
    <div class="max-w-md w-full space-y-8">
        <div class="text-center">
            <div class="flex items-center justify-center w-16 h-16 bg-primary rounded-full mx-auto mb-4">
                <span class="text-primary-foreground text-2xl">🚗</span>
            </div>
            <h2 class="text-3xl font-bold text-foreground">회원가입</h2>
            <p class="mt-2 text-sm text-muted-foreground">
                법인차량 예약관리 시스템에 가입하세요
            </p>
        </div>

        <div class="bg-card p-8 rounded-lg shadow-lg border border-border">
            @if (!string.IsNullOrEmpty(Message))
            {
                <div class="mb-4 p-3 rounded-md @(IsSuccess ? "bg-green-100 text-green-800" : "bg-red-100 text-red-800")">
                    @Message
                </div>
            }

            <form @formname="signup-form" @onsubmit="HandleSignUp" @onsubmit:preventDefault="true">
                <div class="space-y-4">
                    <div>
                        <label for="name" class="block text-sm font-medium text-foreground mb-1">
                            이름
                        </label>
                        <input
                            id="name"
                            type="text"
                            @bind="Name"
                            @bind:event="oninput"
                            class="w-full px-3 py-2 border border-input rounded-md shadow-sm placeholder-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:border-transparent"
                            placeholder="홍길동"
                            required />
                    </div>

                    <div>
                        <label for="email" class="block text-sm font-medium text-foreground mb-1">
                            이메일
                        </label>
                        <input
                            id="email"
                            type="email"
                            @bind="Email"
                            @bind:event="oninput"
                            class="w-full px-3 py-2 border border-input rounded-md shadow-sm placeholder-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:border-transparent"
                            placeholder="your.email@company.com"
                            required />
                    </div>

                    <div>
                        <label for="department" class="block text-sm font-medium text-foreground mb-1">
                            부서
                        </label>
                        <select
                            id="department"
                            @bind="Department"
                            class="w-full px-3 py-2 border border-input rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-ring focus:border-transparent"
                            required>
                            <option value="">부서를 선택하세요</option>
                            <option value="프로젝트 1팀">프로젝트 1팀</option>
                            <option value="프로젝트 2팀">프로젝트 2팀</option>
                            <option value="연구개발팀">연구개발팀</option>
                            <option value="경영지원팀">경영지원팀</option>
                            <option value="기술영업팀">기술영업팀</option>
                        </select>
                    </div>

                    <div>
                        <label for="password" class="block text-sm font-medium text-foreground mb-1">
                            비밀번호
                        </label>
                        <input
                            id="password"
                            type="password"
                            @bind="Password"
                            @bind:event="oninput"
                            class="w-full px-3 py-2 border border-input rounded-md shadow-sm placeholder-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:border-transparent"
                            placeholder="비밀번호를 입력하세요"
                            required />
                    </div>

                    <div>
                        <label for="confirmPassword" class="block text-sm font-medium text-foreground mb-1">
                            비밀번호 확인
                        </label>
                        <input
                            id="confirmPassword"
                            type="password"
                            @bind="ConfirmPassword"
                            @bind:event="oninput"
                            class="w-full px-3 py-2 border border-input rounded-md shadow-sm placeholder-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:border-transparent"
                            placeholder="비밀번호를 다시 입력하세요"
                            required />
                    </div>
                </div>

                <div class="mt-6">
                    <button
                        type="submit"
                        disabled="@IsLoading"
                        class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-primary-foreground bg-primary hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-ring disabled:opacity-50 disabled:cursor-not-allowed">
                        @if (IsLoading)
                        {
                            <span class="flex items-center">
                                <span class="animate-spin mr-2">⏳</span>
                                회원가입 중...
                            </span>
                        }
                        else
                        {
                            <span>회원가입</span>
                        }
                    </button>
                </div>

                <div class="mt-4 text-center">
                    <button
                        type="button"
                        @onclick="() => OnSwitchToSignIn.InvokeAsync()"
                        class="text-sm text-primary hover:text-primary/80 transition-colors">
                        이미 계정이 있으신가요? 로그인하기
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

@code {
    [Parameter] public EventCallback<(string Name, string Email, string Department, string Password)> OnSignUp { get; set; }
    [Parameter] public EventCallback OnSwitchToSignIn { get; set; }

    private string Name = "";
    private string Email = "";
    private string Department = "";
    private string Password = "";
    private string ConfirmPassword = "";
    private bool IsLoading = false;
    private string Message = "";
    private bool IsSuccess = false;

    private async Task HandleSignUp()
    {
        // 유효성 검사
        if (string.IsNullOrWhiteSpace(Name))
        {
            Message = "이름을 입력해주세요.";
            IsSuccess = false;
            return;
        }

        if (string.IsNullOrWhiteSpace(Email))
        {
            Message = "이메일을 입력해주세요.";
            IsSuccess = false;
            return;
        }

        if (string.IsNullOrWhiteSpace(Department))
        {
            Message = "부서를 선택해주세요.";
            IsSuccess = false;
            return;
        }

        if (string.IsNullOrWhiteSpace(Password))
        {
            Message = "비밀번호를 입력해주세요.";
            IsSuccess = false;
            return;
        }

        if (Password.Length < 6)
        {
            Message = "비밀번호는 6자 이상이어야 합니다.";
            IsSuccess = false;
            return;
        }

        if (Password != ConfirmPassword)
        {
            Message = "비밀번호가 일치하지 않습니다.";
            IsSuccess = false;
            return;
        }

        IsLoading = true;
        Message = "";

        try
        {
            await OnSignUp.InvokeAsync((Name, Email, Department, Password));
        }
        finally
        {
            IsLoading = false;
        }
    }

    public void ShowMessage(string message, bool success)
    {
        Message = message;
        IsSuccess = success;
        StateHasChanged();
    }

    public void ClearForm()
    {
        Name = "";
        Email = "";
        Department = "";
        Password = "";
        ConfirmPassword = "";
        Message = "";
        IsSuccess = false;
        StateHasChanged();
    }
}
